---
title: 模板引擎
date: 2018-02-15 15:26:26
categories: API
index: 2
---
# 模板引擎
- **描述：**模板引擎通过遍历查找视图模板上的指令及`{ { ... } }`表达式的方式来解析视图模板，并挂载动态数据。除`{ { } }`表达式外，其他的所有指令均在dom元素的属性上使用，作用范围为该dom元素上，而`{ { } }`表达式可在属性值和html标签之间使用。开发者只需要掌握以下模板指令及`{ { } }`表达式的使用即可，模板指令分为动态指令和静态指令两种：
    - **动态指令：**指令的值会当做JavaScript代码片段来执行（取值范围为当前`Module`对象或`Component`对象的ViewModel），并为使用了动态指令的dom元素创建视图依赖绑定，当依赖的状态（即ViewModel对象内的值）改变时对应绑定的dom元素也将做出同步改变。
    - **静态指令：**指令的值即为一个字符串，不会当做JavaScript代码片段执行，也不会为对应的dom元素创建视图依赖绑定。

> 以下为模板引擎可使用的所有指令

## :for
- **类型：**Dynamic
- **描述：**遍历状态值（即ViewModel对象内的值），根据指定的状态值循环输出目标dom元素，如果目标dom元素为template则循环输出目标元素的子元素集。特定语法为`item in vm_value`或`(item, index) in vm_value`，此时在目标元素及子孙元素上可使用`item`、`index`（需使用第二种表达式指定`index`）两个局部状态，其中`item`、`index`、`vm_value`的变量名是可以随意指定的，且`vm_value`的值支持`Array`、`Number`、`String`三种类型：
    - **Array：**遍历时`item`的值为此数组每项的值，`index`为遍历的下标
    - **Number：**遍历时`item`的值与`index`相同，都是遍历的下标
    - **String：**遍历时`item`的值为此字符串的单个字符，`index`为遍历的下标

## :if
- **类型：**Dynamic
- **描述：**if条件判断，其属性值作为JavaScript代码片段执行后得出的结果为`false`、`""`、`undefined`、`null`、`0`时隐藏目标dom元素，其他结果则显示目标dom元素，当它用于template元素时则会显示或隐藏目标template元素的子元素。它与我们熟知的`if`、`else if`及`else`的用法相同，开发者也可以配合`:else-if`与`:else`一起使用。

## :else-if
- **类型：**Dynamic
- **描述：**`else if`条件判断，它的上一个兄弟元素必须使用了`:if`或`:else-if`指令

## :else
- **类型：**Dynamic
- **描述：**`else`条件判断，它的上一个兄弟元素必须使用了`:if`或`:else-if`指令，且不能有指令值

## :on
- **类型：**Dynamic
- **描述：**事件绑定指令，所有绑定事件都可以使用指令`:on+事件名称`来进行绑定，如`:onclick`表示为目标dom元素绑定点击事件。它的值可分为n种形式：
    - 直接绑定状态函数（即ViewModel中的函数）,如`:onclick="clickHandler"`，这个状态函数的第一个参数总是`event`对象，如需要接收额外的参数可这样写`:onclick="clickHandler(arg1[, arg2][, arg3][...])"`，`arg1`、`arg2`...可以为任何值，当与`:for`指令一起使用时`arg1`、`arg2`还可以传入局部变量。当在状态函数中接收额外的参数时总是从第二个开始接收，因为第一个参数总是`event`对象。
    - JavaScript代码片段（取值范围为当前`Module`对象或`Component`对象的ViewModel），触发事件时直接执行此代码片段

## :model
- **类型：**Dynamic
- **描述：**表单dom元素双向绑定指令([双向绑定？](#))，它只能用于`input`、`select`、`textarea`等所有表单dom元素。
- **特殊情况：**当表单dom元素为`checkbox`时，它的绑定状态需设置为数组，数组的值为一个或多个已勾选的`checkbox`的value值

## 插值表达式
- **类型：**Dynamic
- **描述：**双花括号内只能为一个状态变量名（即ViewModel中变量名），它可以在dom元素的任何属性以及html标签之间，以单个表达式、多个表达式及表达式加普通字符混合来使用，如`id="{ { id } }"`、`id="{ { id1 } }11_{ { id2 } }22"`。被引用的状态值将调用`toString`方法转换成字符串后再输出到对应的位置。
- **特殊情况：**
    - **当插值表达式用与`class`属性，且值为数组时，在挂载数据时会将此数组自动转换为以一个空格隔开的值
    - **当插值表达式用于`style`属性，且值为`Object`对象时，在挂载数据时会将此Object对象自动转换为元素内联`style`所支持的格式。此`Object`对象内的css属性名以驼峰式定义，属性值如`fontSize`为数字时，在挂载时值的末尾将自动补充`px`单位

## :ref
- **类型：**Static
- **描述：**指定需要被引用的dom元素或组件，通过`Module`对象的`refs`成员函数获取被引用的元素。当在普通dom元素上使用时，通过`refs`函数可获取此dom元素，如需聚焦一个表单元素时可使用这个方式来获取需聚焦的表单元素；当在组件元素上使用时，通过`refs`函数可获取此组件的行为对象([组件行为对象？](#))，从而对此组件的行为进行操作。它不可用于`<template>`元素上

## :module
- **类型：**Static
- **描述：**指定一个dom元素为模块元素